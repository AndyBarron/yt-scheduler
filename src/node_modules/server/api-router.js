const express = require('express');
const yt = require('./yt');

const router = new express.Router();
module.exports = router;

const sendJson = (req, res, data) => {
  if (req.xhr) {
    res.json(data);
  } else {
    res.type('text/json').send(JSON.stringify(data, null, 2));
  }
};

const routes = {
  '/info/:id': async (req, res) => {
    const info = await yt.getVideoInfo(req.params.id);
    sendJson(req, res, info);
  }
}

for (const [route, handler] of Object.entries(routes)) {
  router.get(route, async (req, res) => {
    try {
      await handler(req, res);
    } catch (e) {
      console.error('Internal error:');
      console.error(e);
      res.status(500).json({message: 'An internal error occurred.'});
    }
  });
}